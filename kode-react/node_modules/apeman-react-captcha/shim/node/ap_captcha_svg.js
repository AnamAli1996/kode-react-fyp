/**
 * SVG captcha.
 * DO NOT use svg base captcha in production, since it may be parsable by bots.
 * You need to convert to bitmap like png beforehand.
 * @class ApCaptchaSvg
 */

'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _randomval = require('randomval');

var _randomval2 = _interopRequireDefault(_randomval);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var dummyLetter = function dummyLetter() {
  var letters = arguments.length <= 0 || arguments[0] === undefined ? '1234567890abcdefg' : arguments[0];
  return letters[(0, _randomval.randomInt)(0, letters.length - 1)];
};

/** @lends ApCaptchaSvg */

var ApCaptchaSvg = function (_Component) {
  _inherits(ApCaptchaSvg, _Component);

  function ApCaptchaSvg() {
    _classCallCheck(this, ApCaptchaSvg);

    return _possibleConstructorReturn(this, (ApCaptchaSvg.__proto__ || Object.getPrototypeOf(ApCaptchaSvg)).apply(this, arguments));
  }

  _createClass(ApCaptchaSvg, [{
    key: 'render',
    value: function render() {
      var s = this;
      var props = s.props;


      var color = '#555';

      var width = props.width;
      var height = props.height;


      var backgrounds = [0, 1, 2, 3].map(function (val, i, _ref) {
        var length = _ref.length;

        var margin = width * 0.2;
        var rate = (i + 0.5) / length;
        return _react2.default.createElement(ApCaptchaSvg.StripeBlock, { rate: rate,
          key: i + '-' + val,
          color: color,
          blockProps: {
            key: 'bg-' + i,
            width: parseInt(width / length + margin * 2),
            height: parseInt(height + margin * 2),
            x: parseInt(width * rate - margin),
            y: parseInt(0 - margin)
          }
        });
      });

      var texts = props.text.split('').map(function (letter, i, letters) {
        var indices = [0, 1, 2, 3, 4, 5];
        var real = (0, _randomval.randomInt)(0, indices.length - 1);
        var texts = indices.map(function (j) {
          var rate = i / letters.length;
          var key = 'letter-' + i + '-' + j;
          var isReal = j === real;
          return _react2.default.createElement(ApCaptchaSvg.Letter, { letter: isReal ? letter : dummyLetter(),
            rate: rate,
            width: width,
            height: height,
            textProps: {
              key: key,
              fill: isReal ? color : 'rgba(255,255,255,' + 0.01 * (0, _randomval.randomInt)(0, 30) + ')'
            },
            key: i + '-' + j + '-' + letter
          });
        });
        return _react2.default.createElement(
          'g',
          { key: 'letter-group-' + i },
          texts
        );
      });
      return _react2.default.createElement(
        'svg',
        { version: props.version,
          width: width,
          height: height,
          xmlns: props.xmlns,
          viewBox: '0 0 ' + width + ' ' + height
        },
        _react2.default.createElement(
          'g',
          null,
          backgrounds
        ),
        _react2.default.createElement(
          'g',
          null,
          texts
        )
      );
    }
  }], [{
    key: 'Letter',
    value: function Letter(_ref2) {
      var letter = _ref2.letter;
      var rate = _ref2.rate;
      var width = _ref2.width;
      var height = _ref2.height;
      var textProps = _ref2.textProps;

      var padding = 16;

      var w = width - padding * 2;
      var h = height;

      var moveRange = h / 20;
      var move = _randomval.randomInt.bind(_randomval2.default, moveRange * -1, moveRange);

      var fontSize = h * 0.8;
      var x = padding + w * rate + fontSize / 4;
      var y = fontSize;
      var rotateRange = 40;
      var rotate = (0, _randomval.randomInt)(-rotateRange, rotateRange);
      return _react2.default.createElement(
        'text',
        _extends({ x: parseInt(x),
          y: parseInt(y),
          fontSize: parseInt(fontSize),
          transform: 'translate(' + move() + ', ' + move() + ') rotate(' + parseInt(rotate) + ', ' + parseInt(x) + ', ' + parseInt(y) + ')'
        }, textProps),
        letter
      );
    }
  }, {
    key: 'StripeBlock',
    value: function StripeBlock(_ref3) {
      var rate = _ref3.rate;
      var color = _ref3.color;
      var blockProps = _ref3.blockProps;

      var rotate = (0, _randomval.randomInt)(-90, 90);

      var lines = [];
      var lineWidth = 1;
      var w = blockProps.width;
      var h = blockProps.height;

      var left = w * -0.5;
      var right = w * 1.5;

      for (var x = left; x < right; x += lineWidth * 6) {
        lines.push(_react2.default.createElement('line', { x1: parseInt(x),
          y1: parseInt(0),
          x2: parseInt(x),
          y2: parseInt(h),
          key: 'line-' + x,
          stroke: color
        }));
      }

      return _react2.default.createElement(
        'svg',
        blockProps,
        _react2.default.createElement(
          'g',
          {
            transform: 'scale(1.3) rotate(' + parseInt(rotate) + ', ' + parseInt(blockProps.width / 2) + ', ' + parseInt(blockProps.height / 2) + ')' },
          lines
        )
      );
    }
  }]);

  return ApCaptchaSvg;
}(_react.Component);

Object.assign(ApCaptchaSvg, {
  // --------------------
  // Specs
  // --------------------

  propsTypes: {
    version: _react.PropTypes.string,
    text: _react.PropTypes.string.isRequired,
    width: _react.PropTypes.number,
    height: _react.PropTypes.number
  },

  defaultProps: {
    version: '1.1',
    xmlns: 'http://www.w3.org/2000/svg',
    text: '',
    width: 256,
    height: 92
  }
});

exports.default = ApCaptchaSvg;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwX2NhcHRjaGFfc3ZnLmpzeCJdLCJuYW1lcyI6WyJkdW1teUxldHRlciIsImxldHRlcnMiLCJsZW5ndGgiLCJBcENhcHRjaGFTdmciLCJzIiwicHJvcHMiLCJjb2xvciIsIndpZHRoIiwiaGVpZ2h0IiwiYmFja2dyb3VuZHMiLCJtYXAiLCJ2YWwiLCJpIiwibWFyZ2luIiwicmF0ZSIsImtleSIsInBhcnNlSW50IiwieCIsInkiLCJ0ZXh0cyIsInRleHQiLCJzcGxpdCIsImxldHRlciIsImluZGljZXMiLCJyZWFsIiwiaiIsImlzUmVhbCIsImZpbGwiLCJ2ZXJzaW9uIiwieG1sbnMiLCJ0ZXh0UHJvcHMiLCJwYWRkaW5nIiwidyIsImgiLCJtb3ZlUmFuZ2UiLCJtb3ZlIiwiYmluZCIsImZvbnRTaXplIiwicm90YXRlUmFuZ2UiLCJyb3RhdGUiLCJibG9ja1Byb3BzIiwibGluZXMiLCJsaW5lV2lkdGgiLCJsZWZ0IiwicmlnaHQiLCJwdXNoIiwiT2JqZWN0IiwiYXNzaWduIiwicHJvcHNUeXBlcyIsInN0cmluZyIsImlzUmVxdWlyZWQiLCJudW1iZXIiLCJkZWZhdWx0UHJvcHMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O0FBT0E7Ozs7Ozs7Ozs7QUFFQTs7OztBQUNBOzs7Ozs7Ozs7Ozs7QUFFQSxJQUFJQSxjQUFjLFNBQWRBLFdBQWM7QUFBQSxNQUFDQyxPQUFELHlEQUFXLG1CQUFYO0FBQUEsU0FBbUNBLFFBQVMsMEJBQVUsQ0FBVixFQUFhQSxRQUFRQyxNQUFSLEdBQWlCLENBQTlCLENBQVQsQ0FBbkM7QUFBQSxDQUFsQjs7QUFFQTs7SUFDTUMsWTs7Ozs7Ozs7Ozs7NkJBQ007QUFDUixVQUFNQyxJQUFJLElBQVY7QUFEUSxVQUVGQyxLQUZFLEdBRVFELENBRlIsQ0FFRkMsS0FGRTs7O0FBSVIsVUFBSUMsUUFBUSxNQUFaOztBQUpRLFVBTUZDLEtBTkUsR0FNZ0JGLEtBTmhCLENBTUZFLEtBTkU7QUFBQSxVQU1LQyxNQU5MLEdBTWdCSCxLQU5oQixDQU1LRyxNQU5MOzs7QUFRUixVQUFJQyxjQUFjLENBQUUsQ0FBRixFQUFLLENBQUwsRUFBUSxDQUFSLEVBQVcsQ0FBWCxFQUFlQyxHQUFmLENBQW1CLFVBQUNDLEdBQUQsRUFBTUMsQ0FBTixRQUF3QjtBQUFBLFlBQWJWLE1BQWEsUUFBYkEsTUFBYTs7QUFDM0QsWUFBSVcsU0FBU04sUUFBUSxHQUFyQjtBQUNBLFlBQUlPLE9BQU8sQ0FBQ0YsSUFBSSxHQUFMLElBQVlWLE1BQXZCO0FBQ0EsZUFDRSw4QkFBQyxZQUFELENBQWMsV0FBZCxJQUEwQixNQUFPWSxJQUFqQztBQUMwQixlQUFTRixDQUFULFNBQWNELEdBRHhDO0FBRTBCLGlCQUFRTCxLQUZsQztBQUcwQixzQkFBYTtBQUNYUyx5QkFBV0gsQ0FEQTtBQUVYTCxtQkFBT1MsU0FBU1QsUUFBUUwsTUFBUixHQUFrQlcsU0FBUyxDQUFwQyxDQUZJO0FBR1hMLG9CQUFRUSxTQUFTUixTQUFVSyxTQUFTLENBQTVCLENBSEc7QUFJWEksZUFBR0QsU0FBU1QsUUFBUU8sSUFBUixHQUFlRCxNQUF4QixDQUpRO0FBS1hLLGVBQUdGLFNBQVMsSUFBSUgsTUFBYjtBQUxRO0FBSHZDLFVBREY7QUFhRCxPQWhCaUIsQ0FBbEI7O0FBa0JBLFVBQUlNLFFBQVFkLE1BQU1lLElBQU4sQ0FBV0MsS0FBWCxDQUFpQixFQUFqQixFQUFxQlgsR0FBckIsQ0FBeUIsVUFBQ1ksTUFBRCxFQUFTVixDQUFULEVBQVlYLE9BQVosRUFBd0I7QUFDM0QsWUFBSXNCLFVBQVUsQ0FBRSxDQUFGLEVBQUssQ0FBTCxFQUFRLENBQVIsRUFBVyxDQUFYLEVBQWMsQ0FBZCxFQUFpQixDQUFqQixDQUFkO0FBQ0EsWUFBSUMsT0FBTywwQkFBVSxDQUFWLEVBQWFELFFBQVFyQixNQUFSLEdBQWlCLENBQTlCLENBQVg7QUFDQSxZQUFJaUIsUUFBUUksUUFBUWIsR0FBUixDQUFZLFVBQUNlLENBQUQsRUFBTztBQUM3QixjQUFJWCxPQUFPRixJQUFJWCxRQUFRQyxNQUF2QjtBQUNBLGNBQUlhLGtCQUFnQkgsQ0FBaEIsU0FBcUJhLENBQXpCO0FBQ0EsY0FBSUMsU0FBU0QsTUFBTUQsSUFBbkI7QUFDQSxpQkFDRSw4QkFBQyxZQUFELENBQWMsTUFBZCxJQUFxQixRQUFTRSxTQUFTSixNQUFULEdBQWtCdEIsYUFBaEQ7QUFDcUIsa0JBQU9jLElBRDVCO0FBRXFCLG1CQUFRUCxLQUY3QjtBQUdxQixvQkFBU0MsTUFIOUI7QUFJcUIsdUJBQVk7QUFDVk8sc0JBRFU7QUFFVlksb0JBQU1ELFNBQVNwQixLQUFULHlCQUFxQyxPQUFPLDBCQUFVLENBQVYsRUFBYSxFQUFiLENBQTVDO0FBRkksYUFKakM7QUFRcUIsaUJBQVNNLENBQVQsU0FBY2EsQ0FBZCxTQUFtQkg7QUFSeEMsWUFERjtBQVlELFNBaEJXLENBQVo7QUFpQkEsZUFDRTtBQUFBO0FBQUEsWUFBRyx1QkFBcUJWLENBQXhCO0FBQStCTztBQUEvQixTQURGO0FBR0QsT0F2QlcsQ0FBWjtBQXdCQSxhQUNFO0FBQUE7QUFBQSxVQUFLLFNBQVVkLE1BQU11QixPQUFyQjtBQUNLLGlCQUFRckIsS0FEYjtBQUVLLGtCQUFTQyxNQUZkO0FBR0ssaUJBQVFILE1BQU13QixLQUhuQjtBQUlLLDRCQUFnQnRCLEtBQWhCLFNBQXlCQztBQUo5QjtBQU1FO0FBQUE7QUFBQTtBQUFJQztBQUFKLFNBTkY7QUFPRTtBQUFBO0FBQUE7QUFBSVU7QUFBSjtBQVBGLE9BREY7QUFXRDs7O2tDQUUwRDtBQUFBLFVBQTFDRyxNQUEwQyxTQUExQ0EsTUFBMEM7QUFBQSxVQUFsQ1IsSUFBa0MsU0FBbENBLElBQWtDO0FBQUEsVUFBNUJQLEtBQTRCLFNBQTVCQSxLQUE0QjtBQUFBLFVBQXJCQyxNQUFxQixTQUFyQkEsTUFBcUI7QUFBQSxVQUFic0IsU0FBYSxTQUFiQSxTQUFhOztBQUN6RCxVQUFJQyxVQUFVLEVBQWQ7O0FBRUEsVUFBSUMsSUFBSXpCLFFBQVN3QixVQUFVLENBQTNCO0FBQ0EsVUFBSUUsSUFBSXpCLE1BQVI7O0FBRUEsVUFBSTBCLFlBQVlELElBQUksRUFBcEI7QUFDQSxVQUFJRSxPQUFPLHFCQUFVQyxJQUFWLHNCQUEwQkYsWUFBWSxDQUFDLENBQXZDLEVBQTBDQSxTQUExQyxDQUFYOztBQUVBLFVBQUlHLFdBQVdKLElBQUksR0FBbkI7QUFDQSxVQUFJaEIsSUFBSWMsVUFBVUMsSUFBSWxCLElBQWQsR0FBc0J1QixXQUFXLENBQXpDO0FBQ0EsVUFBSW5CLElBQUltQixRQUFSO0FBQ0EsVUFBSUMsY0FBYyxFQUFsQjtBQUNBLFVBQUlDLFNBQVMsMEJBQVUsQ0FBQ0QsV0FBWCxFQUF3QkEsV0FBeEIsQ0FBYjtBQUNBLGFBQ0U7QUFBQTtBQUFBLG1CQUFNLEdBQUl0QixTQUFTQyxDQUFULENBQVY7QUFDTSxhQUFJRCxTQUFTRSxDQUFULENBRFY7QUFFTSxvQkFBV0YsU0FBU3FCLFFBQVQsQ0FGakI7QUFHTSxvQ0FBeUJGLE1BQXpCLFVBQW9DQSxNQUFwQyxpQkFBc0RuQixTQUFTdUIsTUFBVCxDQUF0RCxVQUEyRXZCLFNBQVNDLENBQVQsQ0FBM0UsVUFBMkZELFNBQVNFLENBQVQsQ0FBM0Y7QUFITixXQUlVWSxTQUpWO0FBS0dSO0FBTEgsT0FERjtBQVFEOzs7dUNBRWdEO0FBQUEsVUFBM0JSLElBQTJCLFNBQTNCQSxJQUEyQjtBQUFBLFVBQXJCUixLQUFxQixTQUFyQkEsS0FBcUI7QUFBQSxVQUFka0MsVUFBYyxTQUFkQSxVQUFjOztBQUMvQyxVQUFJRCxTQUFTLDBCQUFVLENBQUMsRUFBWCxFQUFlLEVBQWYsQ0FBYjs7QUFFQSxVQUFJRSxRQUFRLEVBQVo7QUFDQSxVQUFJQyxZQUFZLENBQWhCO0FBQ0EsVUFBSVYsSUFBSVEsV0FBV2pDLEtBQW5CO0FBQ0EsVUFBSTBCLElBQUlPLFdBQVdoQyxNQUFuQjs7QUFFQSxVQUFJbUMsT0FBT1gsSUFBSSxDQUFDLEdBQWhCO0FBQ0EsVUFBSVksUUFBUVosSUFBSSxHQUFoQjs7QUFFQSxXQUFLLElBQUlmLElBQUkwQixJQUFiLEVBQW1CMUIsSUFBSTJCLEtBQXZCLEVBQThCM0IsS0FBS3lCLFlBQVksQ0FBL0MsRUFBa0Q7QUFDaERELGNBQU1JLElBQU4sQ0FDRSx3Q0FBTSxJQUFJN0IsU0FBU0MsQ0FBVCxDQUFWO0FBQ00sY0FBSUQsU0FBUyxDQUFULENBRFY7QUFFTSxjQUFJQSxTQUFTQyxDQUFULENBRlY7QUFHTSxjQUFJRCxTQUFTaUIsQ0FBVCxDQUhWO0FBSU0seUJBQWFoQixDQUpuQjtBQUtNLGtCQUFRWDtBQUxkLFVBREY7QUFTRDs7QUFFRCxhQUNFO0FBQUE7QUFBVWtDLGtCQUFWO0FBQ0U7QUFBQTtBQUFBO0FBQ0UsOENBQWdDeEIsU0FBU3VCLE1BQVQsQ0FBaEMsVUFBcUR2QixTQUFTd0IsV0FBV2pDLEtBQVgsR0FBbUIsQ0FBNUIsQ0FBckQsVUFBd0ZTLFNBQVN3QixXQUFXaEMsTUFBWCxHQUFvQixDQUE3QixDQUF4RixNQURGO0FBRUlpQztBQUZKO0FBREYsT0FERjtBQVFEOzs7Ozs7QUFFSEssT0FBT0MsTUFBUCxDQUFjNUMsWUFBZCxFQUE0QjtBQUMxQjtBQUNBO0FBQ0E7O0FBRUE2QyxjQUFZO0FBQ1ZwQixhQUFTLGlCQUFNcUIsTUFETDtBQUVWN0IsVUFBTSxpQkFBTTZCLE1BQU4sQ0FBYUMsVUFGVDtBQUdWM0MsV0FBTyxpQkFBTTRDLE1BSEg7QUFJVjNDLFlBQVEsaUJBQU0yQztBQUpKLEdBTGM7O0FBWTFCQyxnQkFBYztBQUNaeEIsYUFBUyxLQURHO0FBRVpDLFdBQU8sNEJBRks7QUFHWlQsVUFBTSxFQUhNO0FBSVpiLFdBQU8sR0FKSztBQUtaQyxZQUFRO0FBTEk7QUFaWSxDQUE1Qjs7a0JBcUJlTCxZIiwiZmlsZSI6ImFwX2NhcHRjaGFfc3ZnLmpzeCIsInNvdXJjZVJvb3QiOiJsaWIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFNWRyBjYXB0Y2hhLlxuICogRE8gTk9UIHVzZSBzdmcgYmFzZSBjYXB0Y2hhIGluIHByb2R1Y3Rpb24sIHNpbmNlIGl0IG1heSBiZSBwYXJzYWJsZSBieSBib3RzLlxuICogWW91IG5lZWQgdG8gY29udmVydCB0byBiaXRtYXAgbGlrZSBwbmcgYmVmb3JlaGFuZC5cbiAqIEBjbGFzcyBBcENhcHRjaGFTdmdcbiAqL1xuXG4ndXNlIHN0cmljdCdcblxuaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCwgUHJvcFR5cGVzIGFzIHR5cGVzIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgcmFuZG9tdmFsLCB7IHJhbmRvbUludCB9IGZyb20gJ3JhbmRvbXZhbCdcblxubGV0IGR1bW15TGV0dGVyID0gKGxldHRlcnMgPSAnMTIzNDU2Nzg5MGFiY2RlZmcnKSA9PiBsZXR0ZXJzWyByYW5kb21JbnQoMCwgbGV0dGVycy5sZW5ndGggLSAxKSBdXG5cbi8qKiBAbGVuZHMgQXBDYXB0Y2hhU3ZnICovXG5jbGFzcyBBcENhcHRjaGFTdmcgZXh0ZW5kcyBDb21wb25lbnQge1xuICByZW5kZXIgKCkge1xuICAgIGNvbnN0IHMgPSB0aGlzXG4gICAgbGV0IHsgcHJvcHMgfSA9IHNcblxuICAgIGxldCBjb2xvciA9ICcjNTU1J1xuXG4gICAgbGV0IHsgd2lkdGgsIGhlaWdodCB9ID0gcHJvcHNcblxuICAgIGxldCBiYWNrZ3JvdW5kcyA9IFsgMCwgMSwgMiwgMyBdLm1hcCgodmFsLCBpLCB7IGxlbmd0aCB9KSA9PiB7XG4gICAgICBsZXQgbWFyZ2luID0gd2lkdGggKiAwLjJcbiAgICAgIGxldCByYXRlID0gKGkgKyAwLjUpIC8gbGVuZ3RoXG4gICAgICByZXR1cm4gKFxuICAgICAgICA8QXBDYXB0Y2hhU3ZnLlN0cmlwZUJsb2NrIHJhdGU9eyByYXRlIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk9eyBgJHtpfS0ke3ZhbH1gIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcj17IGNvbG9yIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9ja1Byb3BzPXsge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBgYmctJHtpfWAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogcGFyc2VJbnQod2lkdGggLyBsZW5ndGggKyAobWFyZ2luICogMikpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBwYXJzZUludChoZWlnaHQgKyAobWFyZ2luICogMikpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogcGFyc2VJbnQod2lkdGggKiByYXRlIC0gbWFyZ2luKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IHBhcnNlSW50KDAgLSBtYXJnaW4pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB9XG4gICAgICAgIC8+XG4gICAgICApXG4gICAgfSlcblxuICAgIGxldCB0ZXh0cyA9IHByb3BzLnRleHQuc3BsaXQoJycpLm1hcCgobGV0dGVyLCBpLCBsZXR0ZXJzKSA9PiB7XG4gICAgICBsZXQgaW5kaWNlcyA9IFsgMCwgMSwgMiwgMywgNCwgNSBdXG4gICAgICBsZXQgcmVhbCA9IHJhbmRvbUludCgwLCBpbmRpY2VzLmxlbmd0aCAtIDEpXG4gICAgICBsZXQgdGV4dHMgPSBpbmRpY2VzLm1hcCgoaikgPT4ge1xuICAgICAgICBsZXQgcmF0ZSA9IGkgLyBsZXR0ZXJzLmxlbmd0aFxuICAgICAgICBsZXQga2V5ID0gYGxldHRlci0ke2l9LSR7an1gXG4gICAgICAgIGxldCBpc1JlYWwgPSBqID09PSByZWFsXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgPEFwQ2FwdGNoYVN2Zy5MZXR0ZXIgbGV0dGVyPXsgaXNSZWFsID8gbGV0dGVyIDogZHVtbXlMZXR0ZXIoKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0ZT17IHJhdGUgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoPXsgd2lkdGggfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodD17IGhlaWdodCB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dFByb3BzPXsge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDogaXNSZWFsID8gY29sb3IgOiBgcmdiYSgyNTUsMjU1LDI1NSwkezAuMDEgKiByYW5kb21JbnQoMCwgMzApfSlgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5PXsgYCR7aX0tJHtqfS0ke2xldHRlcn1gIH1cbiAgICAgICAgICAvPlxuICAgICAgICApXG4gICAgICB9KVxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGcga2V5PXtgbGV0dGVyLWdyb3VwLSR7aX1gfT57IHRleHRzIH08L2c+XG4gICAgICApXG4gICAgfSlcbiAgICByZXR1cm4gKFxuICAgICAgPHN2ZyB2ZXJzaW9uPXsgcHJvcHMudmVyc2lvbiB9XG4gICAgICAgICAgIHdpZHRoPXsgd2lkdGggfVxuICAgICAgICAgICBoZWlnaHQ9eyBoZWlnaHQgfVxuICAgICAgICAgICB4bWxucz17IHByb3BzLnhtbG5zIH1cbiAgICAgICAgICAgdmlld0JveD17YDAgMCAke3dpZHRofSAke2hlaWdodH1gfVxuICAgICAgPlxuICAgICAgICA8Zz57YmFja2dyb3VuZHN9PC9nPlxuICAgICAgICA8Zz57dGV4dHN9PC9nPlxuICAgICAgPC9zdmc+XG4gICAgKVxuICB9XG5cbiAgc3RhdGljIExldHRlciAoeyBsZXR0ZXIsIHJhdGUsIHdpZHRoLCBoZWlnaHQsIHRleHRQcm9wcyB9KSB7XG4gICAgbGV0IHBhZGRpbmcgPSAxNlxuXG4gICAgbGV0IHcgPSB3aWR0aCAtIChwYWRkaW5nICogMilcbiAgICBsZXQgaCA9IGhlaWdodFxuXG4gICAgbGV0IG1vdmVSYW5nZSA9IGggLyAyMFxuICAgIGxldCBtb3ZlID0gcmFuZG9tSW50LmJpbmQocmFuZG9tdmFsLCBtb3ZlUmFuZ2UgKiAtMSwgbW92ZVJhbmdlKVxuXG4gICAgbGV0IGZvbnRTaXplID0gaCAqIDAuOFxuICAgIGxldCB4ID0gcGFkZGluZyArIHcgKiByYXRlICsgKGZvbnRTaXplIC8gNClcbiAgICBsZXQgeSA9IGZvbnRTaXplXG4gICAgbGV0IHJvdGF0ZVJhbmdlID0gNDBcbiAgICBsZXQgcm90YXRlID0gcmFuZG9tSW50KC1yb3RhdGVSYW5nZSwgcm90YXRlUmFuZ2UpXG4gICAgcmV0dXJuIChcbiAgICAgIDx0ZXh0IHg9eyBwYXJzZUludCh4KSB9XG4gICAgICAgICAgICB5PXsgcGFyc2VJbnQoeSkgfVxuICAgICAgICAgICAgZm9udFNpemU9eyBwYXJzZUludChmb250U2l6ZSkgfVxuICAgICAgICAgICAgdHJhbnNmb3JtPXsgYHRyYW5zbGF0ZSgke21vdmUoKX0sICR7bW92ZSgpfSkgcm90YXRlKCR7cGFyc2VJbnQocm90YXRlKX0sICR7cGFyc2VJbnQoeCl9LCAke3BhcnNlSW50KHkpfSlgIH1cbiAgICAgICAgICAgIHsuLi50ZXh0UHJvcHN9XG4gICAgICA+eyBsZXR0ZXIgfTwvdGV4dD5cbiAgICApXG4gIH1cblxuICBzdGF0aWMgU3RyaXBlQmxvY2sgKHsgcmF0ZSwgY29sb3IsIGJsb2NrUHJvcHMgfSkge1xuICAgIGxldCByb3RhdGUgPSByYW5kb21JbnQoLTkwLCA5MClcblxuICAgIGxldCBsaW5lcyA9IFtdXG4gICAgbGV0IGxpbmVXaWR0aCA9IDFcbiAgICBsZXQgdyA9IGJsb2NrUHJvcHMud2lkdGhcbiAgICBsZXQgaCA9IGJsb2NrUHJvcHMuaGVpZ2h0XG5cbiAgICBsZXQgbGVmdCA9IHcgKiAtMC41XG4gICAgbGV0IHJpZ2h0ID0gdyAqIDEuNVxuXG4gICAgZm9yIChsZXQgeCA9IGxlZnQ7IHggPCByaWdodDsgeCArPSBsaW5lV2lkdGggKiA2KSB7XG4gICAgICBsaW5lcy5wdXNoKFxuICAgICAgICA8bGluZSB4MT17cGFyc2VJbnQoeCl9XG4gICAgICAgICAgICAgIHkxPXtwYXJzZUludCgwKX1cbiAgICAgICAgICAgICAgeDI9e3BhcnNlSW50KHgpfVxuICAgICAgICAgICAgICB5Mj17cGFyc2VJbnQoaCl9XG4gICAgICAgICAgICAgIGtleT17YGxpbmUtJHt4fWB9XG4gICAgICAgICAgICAgIHN0cm9rZT17Y29sb3J9XG4gICAgICAgIC8+XG4gICAgICApXG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxzdmcgeyAuLi5ibG9ja1Byb3BzIH0+XG4gICAgICAgIDxnXG4gICAgICAgICAgdHJhbnNmb3JtPXtgc2NhbGUoMS4zKSByb3RhdGUoJHtwYXJzZUludChyb3RhdGUpfSwgJHtwYXJzZUludChibG9ja1Byb3BzLndpZHRoIC8gMil9LCAke3BhcnNlSW50KGJsb2NrUHJvcHMuaGVpZ2h0IC8gMil9KWB9PlxuICAgICAgICAgIHsgbGluZXMgfVxuICAgICAgICA8L2c+XG4gICAgICA8L3N2Zz5cbiAgICApXG4gIH1cbn1cbk9iamVjdC5hc3NpZ24oQXBDYXB0Y2hhU3ZnLCB7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFNwZWNzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgcHJvcHNUeXBlczoge1xuICAgIHZlcnNpb246IHR5cGVzLnN0cmluZyxcbiAgICB0ZXh0OiB0eXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICB3aWR0aDogdHlwZXMubnVtYmVyLFxuICAgIGhlaWdodDogdHlwZXMubnVtYmVyXG4gIH0sXG5cbiAgZGVmYXVsdFByb3BzOiB7XG4gICAgdmVyc2lvbjogJzEuMScsXG4gICAgeG1sbnM6ICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsXG4gICAgdGV4dDogJycsXG4gICAgd2lkdGg6IDI1NixcbiAgICBoZWlnaHQ6IDkyXG4gIH1cbn0pXG5cbmV4cG9ydCBkZWZhdWx0IEFwQ2FwdGNoYVN2Z1xuIl19